(function(o,$){typeof exports=="object"&&typeof module<"u"?$(exports,require("@inertiajs/core"),require("@lifespikes/cogent-ts"),require("@inertiajs/react")):typeof define=="function"&&define.amd?define(["exports","@inertiajs/core","@lifespikes/cogent-ts","@inertiajs/react"],$):(o=typeof globalThis<"u"?globalThis:o||self,$((o.Inertia=o.Inertia||{},o.Inertia["js Tables for Laravel Query Builder"]={}),o.InertiaCore,o.cogentTs,o.InertiaReact))})(this,function(o,$,E,O){"use strict";function I(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>t(n)))}function w(e,t){return I(e,n=>!t.includes(n))}function F(e,t){const n={...e};return Object.keys(n).length===0||t.forEach(i=>{const a=i.split("."),f=a.pop();if(!f)return;const s=a.reduce((c,u)=>c[u],n);s&&delete s[f]}),n}function j(e,t="default"){return t==="default"?e:`${t}_${e}`}const B=(e,t="")=>Object.entries(e).flatMap(([n,i])=>typeof i=="object"&&i!==null?t?B(i,`${t}[${n}]`):B(i,`${n}`):t?[`${t}[${n}]=${i}`]:[`${n}=${i}`]);function C(e){const t=new URLSearchParams(e||window.location.search),n={};for(const[i,a]of t.entries()){const f=i.split("[").map(c=>c.endsWith("]")?c.slice(0,-1):c);let s=n;for(let c=0;c<f.length;c++){const u=f[c];s[u]||(c===f.length-1?s[u]=a:s[u]={}),s=s[u]}}return n}function S(){const e=C(),t=(i,a=void 0)=>e[i]||a,n=window.location.origin+window.location.pathname;return{getParam:t,params:e,currentPath:n}}function k(e){const{tableName:t="default",queryKey:n,filters:i}=e||{},{params:a,currentPath:f}=S(),s=n||j("filter",t),c=n||j("page",t),p=E.queryBuilder({baseUrl:f})(),b=r=>F({...a},[...r,e!=null&&e.ignorePagination?c:""]),T=(r,l)=>{let m=b([`${s}.${r}`]);l&&(m={...a,[`${s}[${r}]`]:l}),h(m)},K=(r,l)=>{const m=Object.keys(r).map(P=>`${s}.${P}`);let g=b([...m,...l?l.map(P=>`${s}.${P}`):[]]);m.length&&(g=Object.entries(r).reduce((P,[R,V])=>V?{...P,[`${s}[${R}]`]:V}:P,g)),h(g)},q=(r,l)=>{let m=b([`${s}.${r==null?void 0:r.name}`]);l&&(m={...m,[`${s}[${r==null?void 0:r.name}]`]:l}),h(m)},U=(r,l)=>{const m=i==null?void 0:i.find(g=>g.name===r);if(!m)throw new Error(`Filter with name ${r} not found`);q(m,l)},d=r=>{const l={...F(a,[`${s}.${r.name}`])};h(l)},y=()=>{const r=w(a,[s]);h(r)},Q=r=>{var l;return(l=a[s])==null?void 0:l[r]},h=r=>{$.router.visit(p.params(r).get(),{method:"get",preserveState:!0})};return{onFilter:q,onFilterByName:T,onMultiFilterByObject:K,onFilterFor:U,filterValue:Q,removeFilter:d,clearFilters:y}}function M(e){const{tableProps:t}=O.usePage().props;return t[e]}function v({tableName:e,queryKey:t,column:n}){const i=t||j("sort",e),a=M(e),{params:f,currentPath:s}=S(),u=E.queryBuilder({baseUrl:s,queryParams:{sort:i}})(),p=a.sort,b=w(f,[i]),T=d=>{u.sort([d.name])},K=d=>{u.sort([`-${d.name}`])},q=()=>{u.sort([])};return{onSortBy:d=>{const y=d||n;if(!y)throw new Error("Column is required");Object.keys(b).length>0&&u.params(b),p===y.name?K(y):p===`-${y.name}`?q():T(y),O.router.visit(u.get(),{method:"get"})}}}function L({name:e="default",resource:t}){const n=O.usePage().props,i=t?n[t]:n[e],a=n.tableProps[e];if(!a)throw new Error(`Table ${e} does not exist`);const f=s=>{var c;return((c=a.columns.find(u=>u.name===s))==null?void 0:c.hidden)??!1};return{tableName:e,tableProps:{name:e,...a,...i},isHiddenColumn:f}}o.filterObject=I,o.flattenKeyValueParams=B,o.getParamsObject=C,o.omit=w,o.omitNotation=F,o.queryKeyFor=j,o.useFiltering=k,o.useParams=S,o.useSorting=v,o.useTable=L,o.useTableProps=M,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
